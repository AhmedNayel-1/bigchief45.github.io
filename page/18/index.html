<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">
<head>
  <link href="//gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="generator" content="Hugo 0.61.0" />

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  
  <script type="application/ld+json">
{
    "@context" : "http://schema.org",
    "@type" : "BlogPosting",
    "mainEntityOfPage": {
         "@type": "WebPage",
         "@id": "https:\/\/aalvarez.me\/"
    },
    "articleSection" : "",
    "name" : "Andrés Álvarez",
    "headline" : "Andrés Álvarez",
    "description" : "",
    "inLanguage" : "en-US",
    "author" : "",
    "creator" : "",
    "publisher": "",
    "accountablePerson" : "",
    "copyrightHolder" : "",
    "copyrightYear" : "2020",
    "datePublished": "2020-04-29 12:06:31 -0600 CST",
    "dateModified" : "2020-04-29 12:06:31 -0600 CST",
    "url" : "https:\/\/aalvarez.me\/",
    "wordCount" : "0",
    "keywords" : [ "Blog" ]
}
</script>


  
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-131322667-1', 'auto');
	
	ga('send', 'pageview');
}
</script>


  <title>Andrés Álvarez</title>

  
  <link type="text/css" rel="stylesheet" href="https://aalvarez.me/css/print.css" media="print">
  <link type="text/css" rel="stylesheet" href="https://aalvarez.me/css/poole.css">
  <link type="text/css" rel="stylesheet" href="https://aalvarez.me/css/syntax.css">
  <link type="text/css" rel="stylesheet" href="https://aalvarez.me/css/hyde.css">
  <link type="text/css" rel="stylesheet" href="https://aalvarez.me/css/extra.css">
  <link type="text/css" rel="stylesheet" href="https://aalvarez.me/css/overrides.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abril+Fatface|PT+Sans:400,400i,700">


  
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://aalvarez.me/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="https://aalvarez.me/favicon.png">

  
  <link href="https://aalvarez.me/index.xml" rel="alternate" type="application/rss+xml" title="Andrés Álvarez" />

  
</head>

  <body class="theme-base-08 ">
  <aside class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <a href="https://aalvarez.me/"><h1>Andrés Álvarez</h1></a>
      <p class="lead">
       Software Engineer &amp; Web Developer 
      </p>
    </div>

    <nav>
      <ul class="sidebar-nav">
        <li><a href="https://aalvarez.me/">Home</a> </li>
        <li><a href="https://aalvarez.me/tags/">Tags</a></li>
        <li><a href="https://aalvarez.me/about/"> About Me </a></li><li><a href="https://aalvarez.me/portfolio/"> Portfolio </a></li>
      </ul>
    </nav>

    
    <ul id="social-media" class="list-inline">
      
        <li>
           <a href="mailto:andresalvarez353@gmail.com" target="_blank"><i class="fa fa-envelope fa-2x" title="E-Mail"></i></a>
        </li>
      

      
        <li>
          <a href="https://linkedin.com/in/aalvarez4" target="_blank"><i class="fa fa-linkedin fa-2x" title="LinkedIn"></i></a>
        </li>
      

      
        <li>
          <a href="https://github.com/BigChief45" target="_blank"><i class="fa fa-github fa-2x" title="Github"></i></a>
        </li>
      

      
        <li>
          <a href="https://www.instagram.com/aalvrz_" target="_blank"><i class="fa fa-instagram fa-2x" title="Instagram"></i></a>
        </li>
      

      
        <li>
          <a href="https://aalvarez.me/index.xml" target="_blank"><i class="fa fa-rss fa-2x" title="RSS"></i></a>
        </li>
      
    </ul>

    <p>&copy; 2020. All rights reserved. </p>
  </div>
</aside>

    <main class="content container">
    <div class="posts">

<article class="post">
  <h1 class="post-title">
    <a href="https://aalvarez.me/posts/custom-zenoss-api-endpoints/">Custom Zenoss API Endpoints</a>
  </h1>
  <time datetime="2016-12-20T00:00:00Z" class="post-date">Tue, Dec 20, 2016</time>
  <p>In a <a href="https://aalvarez.me/posts/the-zenoss-json-api.html">previous post</a> I went over the Zenoss JSON API and how it works inside the Zenoss Core. In this post we will apply the concepts learned in that post in order to create custom API endpoints within Zenoss, which can be accessed by the JavaScript front-end, <em>curl</em>, API clients, etc. All this new functionality added from a basic ZenPack.</p>
<h2 id="creating-an-endpoint">Creating an Endpoint</h2>
<p>Assuming that we are starting with a new and fresh ZenPack created with <a href="https://zenpacklib.zenoss.com/en/latest/">zenpacklib</a>, we will proceed to create a simple endpoint.</p>
<p>Let's go ahead and create a file named <code>api.py</code> (can be any name) under the ZenPack's top directory. In this file we will import necessary modules, implement interfaces, and define our <strong>routers</strong> and <strong>facades</strong>. If you still don't know what routers and facades are and what they do, I suggest you first take a look at <a href="https://aalvarez.me/posts/the-zenoss-json-api.html">The Zenoss JSON API</a> post.</p>
<p>First, let's take a quick look at the imports:</p>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> <span style="color:#111">os.path</span>
<span style="color:#f92672">from</span> <span style="color:#111">urlparse</span> <span style="color:#f92672">import</span> <span style="color:#111">urlparse</span>
<span style="color:#f92672">import</span> <span style="color:#111">subprocess</span>

<span style="color:#f92672">from</span> <span style="color:#111">zope.event</span> <span style="color:#f92672">import</span> <span style="color:#111">notify</span>
<span style="color:#f92672">from</span> <span style="color:#111">zope.interface</span> <span style="color:#f92672">import</span> <span style="color:#111">implements</span>
<span style="color:#f92672">from</span> <span style="color:#111">ZODB.transact</span> <span style="color:#f92672">import</span> <span style="color:#111">transact</span>

<span style="color:#f92672">from</span> <span style="color:#111">Products.ZenUtils.Ext</span> <span style="color:#f92672">import</span> <span style="color:#111">DirectRouter</span><span style="color:#111">,</span> <span style="color:#111">DirectResponse</span>
<span style="color:#f92672">from</span> <span style="color:#111">Products</span> <span style="color:#f92672">import</span> <span style="color:#111">Zuul</span>
<span style="color:#f92672">from</span> <span style="color:#111">Products.Zuul.catalog.events</span> <span style="color:#f92672">import</span> <span style="color:#111">IndexingEvent</span>
<span style="color:#f92672">from</span> <span style="color:#111">Products.Zuul.facades</span> <span style="color:#f92672">import</span> <span style="color:#111">ZuulFacade</span>
<span style="color:#f92672">from</span> <span style="color:#111">Products.Zuul.interfaces</span> <span style="color:#f92672">import</span> <span style="color:#111">IFacade</span>
<span style="color:#f92672">from</span> <span style="color:#111">Products.Zuul.utils</span> <span style="color:#f92672">import</span> <span style="color:#111">ZuulMessageFactory</span> <span style="color:#00a8c8">as</span> <span style="color:#111">_t</span>
<span style="color:#f92672">from</span> <span style="color:#111">Products.ZenUtils.Utils</span> <span style="color:#f92672">import</span> <span style="color:#111">zenPath</span>
</code></pre></div><p>Some imports are probably not needed, but the ones that are of our interest are imports such as <code>DirectRouter</code> and <code>DirectResponse</code>, which you might remember from the previous post. Additionally we are also importing the necessary facade, events, and interfaces imports.</p>

  
  <div style="margin: 20px 0px;">
  
    <a href="https://aalvarez.me/tags/api" class="label label-default">api</a></li>
  
    <a href="https://aalvarez.me/tags/zenoss" class="label label-default">zenoss</a></li>
  
    <a href="https://aalvarez.me/tags/zenpacks" class="label label-default">zenpacks</a></li>
  
    <a href="https://aalvarez.me/tags/zope" class="label label-default">zope</a></li>
  
    <a href="https://aalvarez.me/tags/python" class="label label-default">python</a></li>
  
    <a href="https://aalvarez.me/tags/javascript" class="label label-default">javascript</a></li>
  
</div>


  
    <div class="read-more-link">
      <a href="https://aalvarez.me/posts/custom-zenoss-api-endpoints/">Read More…</a>
    </div>
  
</article>
<article class="post">
  <h1 class="post-title">
    <a href="https://aalvarez.me/posts/ssh-monitoring-in-zenpacks/">SSH Monitoring in ZenPacks</a>
  </h1>
  <time datetime="2016-12-14T00:00:00Z" class="post-date">Wed, Dec 14, 2016</time>
  <p>Zenoss usually monitors and collects information using <strong>SNMP</strong> and <strong>SSH</strong> methods. A good example of is the <a href="http://wiki.zenoss.org/ZenPack:Linux_Monitor">linux monitor ZenPack</a> which can collect information such as hard disks, interfaces, and file systems using <strong>both</strong> methods.</p>
<p>SNMP works by installing and configuring an SNMP agent on the machine we want to monitor. This agent will poll the machine for data, and this data can be retrieved by Zenoss using <strong><a href="http://www.net-snmp.org/">net-snmp</a></strong>.</p>
<p>On the other hand, SSH works by configuring a username and password or a path to an SSH key zProperties. This will allow Zenoss to remotely access the host using SSH and execute the corresponding commands and return the corresponding information.</p>
<p>When developing ZenPacks, data collection using SNMP is a relatively common practice. There is even a very good tutorial on <a href="https://zenpacklib.zenoss.com/en/latest/tutorial-snmp-device/index.html">SNMP monitoring using zenpacklib</a>. When using SNMP, the modeler plugins are <code>SnmpPlugin</code> plugins that typically work using a set of <a href="http://www.dpstele.com/snmp/what-does-oid-network-elements.php">OIDs</a> to determine exactly which data is to be modeled.</p>
<h2 id="ssh-in-modeler-plugins">SSH in Modeler Plugins</h2>
<p>In order to make a modeler plugin utilize SSH as it's polling method we need to use a different type of plugin, the <code>CommandPlugin</code> plugin. The structure of this type of plugin is very similar to the <code>SnmpPlugin</code>, however there is one critical variable that must be implemented.</p>

  
  <div style="margin: 20px 0px;">
  
    <a href="https://aalvarez.me/tags/ssh" class="label label-default">ssh</a></li>
  
    <a href="https://aalvarez.me/tags/zenoss" class="label label-default">zenoss</a></li>
  
    <a href="https://aalvarez.me/tags/monitoring" class="label label-default">monitoring</a></li>
  
    <a href="https://aalvarez.me/tags/zenpacks" class="label label-default">zenpacks</a></li>
  
    <a href="https://aalvarez.me/tags/python" class="label label-default">python</a></li>
  
    <a href="https://aalvarez.me/tags/bash" class="label label-default">bash</a></li>
  
</div>


  
    <div class="read-more-link">
      <a href="https://aalvarez.me/posts/ssh-monitoring-in-zenpacks/">Read More…</a>
    </div>
  
</article>
<article class="post">
  <h1 class="post-title">
    <a href="https://aalvarez.me/posts/ip-addresses-a-review/">IP Addresses - A Review</a>
  </h1>
  <time datetime="2016-12-02T00:00:00Z" class="post-date">Fri, Dec 2, 2016</time>
  <p><em>A review of IP addresses, as part of my Computer Networking Fundamentals series.</em></p>
<p>A lot of people know what IP addresses are, and a lot of people also probably know that each device that is connected to the Internet must have a <strong><em>unique</em></strong> IP Address, like <em>108.161.228.70</em></p>
<p>However, in this article I want to do a more in-depth review about IP addresses and how the work.</p>
<p>From a technical point of view and for reviewing purposes, it is worth remembering that IP Addresses (at least IPv4) are <strong>32-bit</strong> addresses, because each number separated by each dot (called <em>octet</em>) is an 8-bit number. Since IP Addresses have 4 octets, these together make a sum of 32-bits.</p>
<!-- raw HTML omitted -->
<p>Since the first two octets make a sum of 16 bits, 2^16 yields a total of 65,536 networks. At the same time, the remaining 16 bits also yield a total of 65,536 different hosts. <strong><em>But</em></strong> these are 65,536 different hosts <strong><em>per each</em></strong> network.</p>
<p>This raises a big issue because it makes it hard to decide how many bits in the IP address should be allocated to the network and how many bits should be allocated for the hosts, without wasting IP addresses. This is where <strong>subnet masks</strong> come in.</p>

  
  <div style="margin: 20px 0px;">
  
    <a href="https://aalvarez.me/tags/networking" class="label label-default">networking</a></li>
  
    <a href="https://aalvarez.me/tags/ip" class="label label-default">ip</a></li>
  
</div>


  
    <div class="read-more-link">
      <a href="https://aalvarez.me/posts/ip-addresses-a-review/">Read More…</a>
    </div>
  
</article>
<article class="post">
  <h1 class="post-title">
    <a href="https://aalvarez.me/posts/working-with-zenoss-events/">Working With Zenoss Events</a>
  </h1>
  <time datetime="2016-11-25T00:00:00Z" class="post-date">Fri, Nov 25, 2016</time>
  <p>Zenoss Events are among the most powerful and useful monitoring features that Zenoss Core provides. Many different types of events are <strong>automatically</strong> generated by Zenoss when important scenarios occur for the devices being monitored.</p>
<h2 id="zenoss-event-architecture">Zenoss Event Architecture</h2>
<p>When an event arrives at Zenoss, it is parsed, associated with an event classification and then typically (but not always), it is inserted into the status table of the events database. Events can then be viewed by users using the Event Console of the Zenoss Graphical User Interface (GUI).</p>
<p>The events system has the concept of active status events and historical events (two different database tables in the MySQL events database).</p>
<p><img src="https://aalvarez.me/posts/working-with-zenoss-events/event_console.jpg" alt="!Zenoss Core 4 Event Console"></p>
<h3 id="understanding-event-classes">Understanding Event Classes</h3>
<p>Zenoss event classes are a simple organizational structure for the different types of events that Zenoss generates and receives. This organization is useful for driving alerting and reporting. You can, for example, create an alerting rule that sends you an email or pages you when the availability of a Web site or page is affected by filtering on the <code>/Status/Web</code> event class^[2].</p>

  
  <div style="margin: 20px 0px;">
  
    <a href="https://aalvarez.me/tags/zenoss" class="label label-default">zenoss</a></li>
  
    <a href="https://aalvarez.me/tags/events" class="label label-default">events</a></li>
  
    <a href="https://aalvarez.me/tags/sysadmin" class="label label-default">sysadmin</a></li>
  
    <a href="https://aalvarez.me/tags/monitoring" class="label label-default">monitoring</a></li>
  
    <a href="https://aalvarez.me/tags/python" class="label label-default">python</a></li>
  
    <a href="https://aalvarez.me/tags/cli" class="label label-default">cli</a></li>
  
    <a href="https://aalvarez.me/tags/zendmd" class="label label-default">zendmd</a></li>
  
</div>


  
    <div class="read-more-link">
      <a href="https://aalvarez.me/posts/working-with-zenoss-events/">Read More…</a>
    </div>
  
</article>
<article class="post">
  <h1 class="post-title">
    <a href="https://aalvarez.me/posts/the-zenoss-json-api/">The Zenoss JSON API</a>
  </h1>
  <time datetime="2016-11-24T00:00:00Z" class="post-date">Thu, Nov 24, 2016</time>
  <p>The <a href="http://wiki.zenoss.org/Working_with_the_JSON_API">Zenoss JSON API</a> allows us to obtain very important information of what is going on in Zenoss, such as device information and events. This API can be queried using <a href="https://curl.haxx.se/">cURL</a> or with some wrappers provided by Zenoss, available in languages such as Bashscript, Python, and Java.</p>
<p>The API documentation can be downloaded <a href="https://www.zenoss.com/sites/default/files/documentation/Zenoss_JSON_API_r5.0.4_d28.15.180_0.zip">here</a>. In the documentation you can see the available endpoints and methods that can be used to obtain the data we need.</p>
<p>In this post I will cover how the Zenoss back-end JSON API works, and how the Zenoss's front-end (made using <a href="https://www.sencha.com/products/extjs/">ExtJS</a>) interacts with it.</p>
<p>~&gt; Even though Zenoss calls its API a <em>JSON API</em> (Simply because it returns data in JSON format), the API <strong>is not</strong> <a href="http://jsonapi.org/">JSON API specification</a> compliant.</p>
<h2 id="querying-the-api">Querying the API</h2>
<p>To see the API in action, we can begin by making a simple query using <code>cURL</code>. Let's say we want to obtain all the available information of a specific device:</p>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">curl -u <span style="color:#d88200">&#34;admin:zenoss&#34;</span> -X POST -H <span style="color:#d88200">&#34;Content-Type: application/json&#34;</span> -d <span style="color:#d88200">&#39;{&#34;action&#34;: &#34;DeviceRouter&#34;, &#34;method&#34;: &#34;getInfo&#34;, &#34;data&#34;: [{&#34;uid&#34;: &#34;/zport/dmd/Devices/Server/SSH/Linux/NovaHost/devices/$DEVICE_IP&#34;}], &#34;tid&#34;: 1}&#39;</span> http://<span style="color:#111">$ZENOSS_HOST</span>:8080/zport/dmd/device_router
</code></pre></div><p>The above request will return the information of the device in JSON format, assuming that we replace <code>$ZENOSS_HOST</code> with the IP address of our Zenoss server, and <code>$DEVICE_IP</code> with the IP address of the device we want to query.</p>
<p>This is all fine if all we need is querying the API and nothing else. But what if we really want to know <strong><em>how</em></strong> the API back-end works? How the endpoints are created? What are routers?</p>
<p>This is what we are gonna learn next.</p>

  
  <div style="margin: 20px 0px;">
  
    <a href="https://aalvarez.me/tags/zenoss" class="label label-default">zenoss</a></li>
  
    <a href="https://aalvarez.me/tags/json" class="label label-default">json</a></li>
  
    <a href="https://aalvarez.me/tags/api" class="label label-default">api</a></li>
  
    <a href="https://aalvarez.me/tags/python" class="label label-default">python</a></li>
  
    <a href="https://aalvarez.me/tags/extjs" class="label label-default">extjs</a></li>
  
    <a href="https://aalvarez.me/tags/javascript" class="label label-default">javascript</a></li>
  
    <a href="https://aalvarez.me/tags/curl" class="label label-default">curl</a></li>
  
    <a href="https://aalvarez.me/tags/zope" class="label label-default">zope</a></li>
  
</div>


  
    <div class="read-more-link">
      <a href="https://aalvarez.me/posts/the-zenoss-json-api/">Read More…</a>
    </div>
  
</article>






  <div>
    
      <a href="https://aalvarez.me//page/17/" style="float: left;">← Newer Posts</a>
    

    
      <a href="https://aalvarez.me//page/19/" style="float: right;">Older Posts →</a>
    
  </div>



</div>
    </main>

    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-131322667-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

  </body>
</html>
