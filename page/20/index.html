<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">
<head>
  <link href="//gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="generator" content="Hugo 0.55.6" />

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  
  <script type="application/ld+json">
{
    "@context" : "http://schema.org",
    "@type" : "BlogPosting",
    "mainEntityOfPage": {
         "@type": "WebPage",
         "@id": "https:\/\/aalvarez.me\/"
    },
    "articleSection" : "",
    "name" : "Andrés Álvarez",
    "headline" : "Andrés Álvarez",
    "description" : "",
    "inLanguage" : "en-US",
    "author" : "",
    "creator" : "",
    "publisher": "",
    "accountablePerson" : "",
    "copyrightHolder" : "",
    "copyrightYear" : "2019",
    "datePublished": "2019-08-02 16:34:42 -0600 CST",
    "dateModified" : "2019-08-02 16:34:42 -0600 CST",
    "url" : "https:\/\/aalvarez.me\/",
    "wordCount" : "0",
    "keywords" : [ "Blog" ]
}
</script>


  
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-131322667-1', 'auto');
	
	ga('send', 'pageview');
}
</script>


  <title>Andrés Álvarez</title>

  
  <link type="text/css" rel="stylesheet" href="https://aalvarez.me/css/print.css" media="print">
  <link type="text/css" rel="stylesheet" href="https://aalvarez.me/css/poole.css">
  <link type="text/css" rel="stylesheet" href="https://aalvarez.me/css/syntax.css">
  <link type="text/css" rel="stylesheet" href="https://aalvarez.me/css/hyde.css">
  <link type="text/css" rel="stylesheet" href="https://aalvarez.me/css/extra.css">
  <link type="text/css" rel="stylesheet" href="https://aalvarez.me/css/overrides.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abril+Fatface|PT+Sans:400,400i,700">


  
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://aalvarez.me/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="https://aalvarez.me/favicon.png">

  
  <link href="https://aalvarez.me/index.xml" rel="alternate" type="application/rss+xml" title="Andrés Álvarez" />

  
</head>

  <body class="theme-base-08 ">
  <aside class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <a href="https://aalvarez.me/"><h1>Andrés Álvarez</h1></a>
      <p class="lead">
       Software Engineer &amp; Web Developer 
      </p>
    </div>

    <nav>
      <ul class="sidebar-nav">
        <li><a href="https://aalvarez.me/">Home</a> </li>
        <li><a href="https://aalvarez.me/tags/">Tags</a></li>
        <li><a href="https://aalvarez.me/about/"> About Me </a></li><li><a href="https://aalvarez.me/portfolio/"> Portfolio </a></li>
      </ul>
    </nav>

    
    <ul id="social-media" class="list-inline">
      
        <li>
           <a href="mailto:andresalvarez353@gmail.com" target="_blank"><i class="fa fa-envelope fa-2x" title="E-Mail"></i></a>
        </li>
      

      
        <li>
          <a href="https://linkedin.com/in/aalvarez4" target="_blank"><i class="fa fa-linkedin fa-2x" title="LinkedIn"></i></a>
        </li>
      

      
        <li>
          <a href="https://github.com/BigChief45" target="_blank"><i class="fa fa-github fa-2x" title="Github"></i></a>
        </li>
      

      
        <li>
          <a href="https://www.instagram.com/aalvarez300" target="_blank"><i class="fa fa-instagram fa-2x" title="Instagram"></i></a>
        </li>
      

      
        <li>
          <a href="https://aalvarez.me/index.xml" target="_blank"><i class="fa fa-rss fa-2x" title="RSS"></i></a>
        </li>
      
    </ul>

    <p>&copy; 2019. All rights reserved. </p>
  </div>
</aside>

    <main class="content container">
    <div class="posts">

<article class="post">
  <h1 class="post-title">
    <a href="https://aalvarez.me/posts/creating-zenoss-zenpack-daemons/">Creating Zenoss ZenPack Daemons</a>
  </h1>
  <time datetime="2016-11-07T00:00:00Z" class="post-date">Mon, Nov 7, 2016</time>
  <p>ZenPacks are powerful custom add-ons that can help us extend Zenoss&rsquo;s functionality. In this post I will go over on how to create a ZenPack that adds a custom daemon to the existing Zenoss daemons and runs on a configured cycle time to perform custom tasks. We will achieve this by creating the ZenPack using <a href="http://zenpacklib.zenoss.com/en/latest/index.html"><strong>zenpacklib</strong></a>, but it is also possible to create it from the Zenoss user interface.</p>

<h2 id="about-zenpacklib">About zenpacklib</h2>

<p><strong>zenpacklib</strong> is a Python library developed by the Zenoss team to facilitate the process of creating ZenPacks, specially ZenPacks that deal with modeling and monitoring devices and components. Most of the newer ZenPacks that are being released are now being built with zenpacklib.</p>

<p>We can obtain zenpacklib by running the following commands:</p>

<pre><code>wget http://zenpacklib.zenoss.com/zenpacklib.py
chmod 755 zenpacklib.py
</code></pre>

<p>This will download the zenpacklib Python library and give it executable permissions.</p>

<h2 id="creating-the-zenpack">Creating the ZenPack</h2>

<p>Using the zenpacklib file we just downloaded, we proceed to create a new fresh ZenPack:</p>

<pre><code>./zenpacklib.py create ZenPacks.&lt;your_namespace&gt;.&lt;zenpack_name&gt;
</code></pre>

<p>This will create the ZenPack base directory with the necessary base files.</p>

<p>Now we go into this directory to begin.</p>

<pre><code>cd ZenPacks.&lt;your_namespace&gt;.&lt;zenpack_name&gt;
</code></pre>

<h2 id="creating-the-zenpack-daemon">Creating the ZenPack Daemon</h2>

<p>Our custom daemon declaration will be located in a directory named <code>daemons</code>, inside our ZenPack directory:</p>

<pre><code>mkdir ZenPacks.&lt;your_namespace&gt;.&lt;zenpack_name&gt;/&lt;your_namespace&gt;/&lt;zenpack_name&gt;/daemons
</code></pre>

<p>Here we will create a new Bashscript file with the name of our daemon. In this case we will name it <code>mydaemon</code>:</p>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e">#! /usr/bin/env bash
</span><span style="color:#75715e"></span>
<span style="color:#111">DAEMON_NAME</span><span style="color:#f92672">=</span><span style="color:#d88200">&#34;mydaemon&#34;</span>

. <span style="color:#111">$ZENHOME</span>/bin/zenfunctions

<span style="color:#111">MYPATH</span><span style="color:#f92672">=</span><span style="color:#d88200">`</span>python -c <span style="color:#d88200">&#34;import os.path; print os.path.realpath(&#39;</span><span style="color:#111">$0</span><span style="color:#d88200">&#39;)&#34;</span><span style="color:#d88200">`</span> <span style="color:#111">THISDIR</span><span style="color:#f92672">=</span><span style="color:#d88200">`</span>dirname <span style="color:#111">$MYPATH</span><span style="color:#d88200">`</span> <span style="color:#111">PRGHOME</span><span style="color:#f92672">=</span><span style="color:#d88200">`</span>dirname <span style="color:#111">$THISDIR</span><span style="color:#d88200">`</span> <span style="color:#111">PRGNAME</span><span style="color:#f92672">=</span><span style="color:#111">$DAEMON_NAME</span>.py <span style="color:#111">CFGFILE</span><span style="color:#f92672">=</span><span style="color:#111">$CFGDIR</span>/<span style="color:#111">$DAEMON_NAME</span>.conf

generic <span style="color:#d88200">&#34;</span><span style="color:#111">$@</span><span style="color:#d88200">&#34;</span></code></pre></div>
<p>Once the ZenPack is installed, files under this <code>daemons</code> directory will become executable (<code>chmod 0755</code>), a symlink to the file will be created in <code>$ZENHOME/bin</code>, and a configuration file will be generated in <code>$ZENHOME/etc/&lt;daemon_name&gt;.conf</code></p>

<p><strong>NOTE:</strong> If you created your ZenPack using the Zenoss user interface, the <code>daemons</code> directory will also be automatically created, and will contain an example daemon file named <code>zenexample</code> with code similar to the one above. In this case you should simply replace the necessary values.</p>

  
  <div style="margin: 20px 0px;">
  
    <a href="https://aalvarez.me/tags/zenoss" class="label label-default">zenoss</a></li>
  
    <a href="https://aalvarez.me/tags/zenpacks" class="label label-default">zenpacks</a></li>
  
    <a href="https://aalvarez.me/tags/daemons" class="label label-default">daemons</a></li>
  
    <a href="https://aalvarez.me/tags/monitoring" class="label label-default">monitoring</a></li>
  
    <a href="https://aalvarez.me/tags/python" class="label label-default">python</a></li>
  
    <a href="https://aalvarez.me/tags/devops" class="label label-default">devops</a></li>
  
    <a href="https://aalvarez.me/tags/linux" class="label label-default">linux</a></li>
  
    <a href="https://aalvarez.me/tags/zenpacklib" class="label label-default">zenpacklib</a></li>
  
</div>


  
    <div class="read-more-link">
      <a href="https://aalvarez.me/posts/creating-zenoss-zenpack-daemons/">Read More…</a>
    </div>
  
</article>
<article class="post">
  <h1 class="post-title">
    <a href="https://aalvarez.me/posts/monitoring-cpu-utilization-in-zenoss/">Monitoring CPU Utilization in Zenoss</a>
  </h1>
  <time datetime="2016-11-04T00:00:00Z" class="post-date">Fri, Nov 4, 2016</time>
  <p>While taking a look at the CPU Utilization graphs offered Zenoss Core&rsquo;s <a href="http://wiki.zenoss.org/ZenPack:Linux_Monitor">Linux Monitor ZenPack</a> (v1.2.1), I noticed that the percentage values for <em>Idle</em> were ridiculously high:</p>

<p><img src="https://aalvarez.me/posts/monitoring-cpu-utilization-in-zenoss/cpu_utilization_1.jpg" alt="High Idle CPU Utilization" /></p>

<p>This made sense since this particular device contains 16 cores. However, this then means that the monitoring template isn&rsquo;t really taking this into consideration, and instead just spits out the total value from all cores.</p>

  
  <div style="margin: 20px 0px;">
  
    <a href="https://aalvarez.me/tags/monitoring" class="label label-default">monitoring</a></li>
  
    <a href="https://aalvarez.me/tags/zenoss" class="label label-default">zenoss</a></li>
  
    <a href="https://aalvarez.me/tags/linux" class="label label-default">linux</a></li>
  
    <a href="https://aalvarez.me/tags/devops" class="label label-default">devops</a></li>
  
    <a href="https://aalvarez.me/tags/cpu" class="label label-default">cpu</a></li>
  
    <a href="https://aalvarez.me/tags/sysadmin" class="label label-default">sysadmin</a></li>
  
    <a href="https://aalvarez.me/tags/rrdtool" class="label label-default">rrdtool</a></li>
  
    <a href="https://aalvarez.me/tags/rpn" class="label label-default">rpn</a></li>
  
</div>


  
    <div class="read-more-link">
      <a href="https://aalvarez.me/posts/monitoring-cpu-utilization-in-zenoss/">Read More…</a>
    </div>
  
</article>
<article class="post">
  <h1 class="post-title">
    <a href="https://aalvarez.me/posts/zenoss-monitoring-template-data-points/">Zenoss Monitoring Template Data Points</a>
  </h1>
  <time datetime="2016-11-03T00:00:00Z" class="post-date">Thu, Nov 3, 2016</time>
  <p><em>Content from this post is mostly obtained from <strong>Zenoss Core Administration guide</strong>.</em></p>

<p>In Zenoss Core <strong>monitoring templates</strong>, data sources can return data for one or more performance metrics. Each metric retrieved by a data source is represented
by a <strong>data point</strong>.</p>

<p>When creating a data point, there are some important fields that we can define for our data point:</p>

<ul>
<li><p><strong>Name:</strong> Displays the name you entered in the <em>Add a New DataPoint</em> dialog.</p></li>

<li><p><strong>RRD Type:</strong> Specify the RRD data source type to use for storing data for this data point. (Zenoss Core uses RRDTool to store performance data.) Available options are:</p>

<ul>
<li><strong>COUNTER:</strong> Saves the rate of change of the value over a step period. This assumes that the value is always
increasing (the difference between the current and the previous value is greater than 0). Traffic counters on a
router are an ideal candidate for using COUNTER.</li>

<li><p><strong>GAUGE:</strong> Does not save the rate of change, but saves the actual value. There are no divisions or calculations.
To see memory consumption in a server, for example, you might want to select this value.</p></li>

<li><p><strong>DERIVE:</strong> Same as COUNTER, but additionally allows negative values. If you want to see the rate of change
in free disk space on your server, for example, then you might want to select this value.</p></li>

<li><p><strong>ABSOLUTE:</strong> Saves the rate of change, but assumes that the previous value is set to 0. The difference between
the current and the previous value is always equal to the current value. Thus, ABSOLUTE stores the current
value, divided by the step interval.</p></li>
</ul></li>

<li><p><strong>Create Command:</strong> Enter an RRD expression used to create the database for this data point. If you do not enter
a value, then the system uses a default applicable to most situations. For details about the <kbd>rrdcreate</kbd> command, go <a href="http://oss.oetiker.ch/rrdtool/doc/rrdcreate.en.html">here</a>.</p></li>

<li><p><strong>RRD Minimum:</strong> Enter a value. Any value received that is less than this number is ignored.</p></li>

<li><p><strong>RRD Maximum:</strong> Enter a value. Any value received that is greater than this number is ignored.</p></li>
</ul>

<h2 id="data-point-aliases">Data Point Aliases</h2>

<p>Performance reports pull information from various data points that represent a metric. The report itself knows which
data points it requires, and which modifications are needed, if any, to put the data in its proper units and format.</p>

<p>The addition of a data point requires changing the report.</p>

<p><img src="https://aalvarez.me/posts/zenoss-monitoring-template-data-points/cpu_report.jpg" alt="CPU Utilization Report" /></p>

<p>To allow for more flexibility in changes, some reports use <em>data point aliases</em>. Data point aliases group data points so
they can be more easily used for reporting. In addition, if the data points return data in different units, then the plugin
can normalize that data into a common unit.</p>

  
  <div style="margin: 20px 0px;">
  
    <a href="https://aalvarez.me/tags/zenoss" class="label label-default">zenoss</a></li>
  
    <a href="https://aalvarez.me/tags/monitoring" class="label label-default">monitoring</a></li>
  
    <a href="https://aalvarez.me/tags/snmp" class="label label-default">snmp</a></li>
  
    <a href="https://aalvarez.me/tags/data" class="label label-default">data</a></li>
  
    <a href="https://aalvarez.me/tags/linux" class="label label-default">linux</a></li>
  
    <a href="https://aalvarez.me/tags/cpu" class="label label-default">cpu</a></li>
  
    <a href="https://aalvarez.me/tags/rrdtool" class="label label-default">rrdtool</a></li>
  
    <a href="https://aalvarez.me/tags/rpn" class="label label-default">rpn</a></li>
  
    <a href="https://aalvarez.me/tags/python" class="label label-default">python</a></li>
  
</div>


  
    <div class="read-more-link">
      <a href="https://aalvarez.me/posts/zenoss-monitoring-template-data-points/">Read More…</a>
    </div>
  
</article>
<article class="post">
  <h1 class="post-title">
    <a href="https://aalvarez.me/posts/triggering-commands-from-events-in-zenoss/">Triggering Commands From Events in Zenoss</a>
  </h1>
  <time datetime="2016-10-31T00:00:00Z" class="post-date">Mon, Oct 31, 2016</time>
  <p>In Zenoss Core 4, we can configure some <strong><em>email</em></strong> notifications that produce and send emails based on conditions defined in a trigger, when an event is created.</p>

<p>Additionally, Zenoss Core 4 also provides <strong><em>command</em></strong> type notifications that allow us to execute commands in the Zenoss machine when the trigger criterias are met.</p>

<p>For example, let&rsquo;s say we want to execute a script everytime we ping a device and get no response. This scenario would involve the following:</p>

<ol>
<li>The device is suddenly down.</li>
<li>Zenoss pings the device and gets no response.</li>
<li>The device status is then changed to <em>DOWN</em>.</li>
<li>An Event with an event class of <code>/Status/Ping</code> and a severity of <em>Critical</em> is created.</li>
</ol>

<p>With this information, we can create a trigger that will represent this exact scenario. Moreover, we can configure a command notification to be executed when this trigger is fired.</p>

<h2 id="configuring-a-trigger">Configuring a Trigger</h2>

<ol>
<li>Navigate to Events &gt; Triggers</li>
<li>Create a new trigger.</li>
<li>Add the rules that represent the scenario mentioned before. In this case, all of these rules must apply:</li>
</ol>

<p><img src="https://aalvarez.me/posts/triggering-commands-from-events-in-zenoss/edit_trigger.png" alt="Edit Trigger" /></p>

<p>=&gt; Because we want to make sure the device is truly <em>DOWN</em>, and has been so for quite a while, we also want to add a condition that checks that the event count is greater than a certain number, only then the trigger will be fired, and consequently, the command.</p>

  
  <div style="margin: 20px 0px;">
  
    <a href="https://aalvarez.me/tags/zenoss" class="label label-default">zenoss</a></li>
  
    <a href="https://aalvarez.me/tags/monitoring" class="label label-default">monitoring</a></li>
  
    <a href="https://aalvarez.me/tags/devops" class="label label-default">devops</a></li>
  
</div>


  
    <div class="read-more-link">
      <a href="https://aalvarez.me/posts/triggering-commands-from-events-in-zenoss/">Read More…</a>
    </div>
  
</article>
<article class="post">
  <h1 class="post-title">
    <a href="https://aalvarez.me/posts/keystone-interface-in-juju-charms/">Keystone Interface in Juju Charms</a>
  </h1>
  <time datetime="2016-10-28T00:00:00Z" class="post-date">Fri, Oct 28, 2016</time>
  <p><a href="https://jujucharms.com/docs/1.18/authors-interfaces">Juju Charms interfaces</a> make possible the interaction and exchange of data between services deployed by Juju. In this post I will explain how we can use the Keystone interface to make our custom charm service comunicate with the Keystone service within a Juju environment.</p>

<p>In the end, what we really want to achieve, is to link both services so that they can exchange data, using a Juju command:</p>

<p><code>juju add-relation keystone myservice</code></p>

<h2 id="juju-relations">Juju Relations</h2>

<p>Juju relations operate behind the concept that one service provides something, while another service requires it, and the interaction between the services is done through an <strong>interface</strong>. Since we want to interact with Keystone, this means that we need to use a suitable keystone interface that allows us to get what we need, the <em>keystone Identity data</em>. For this, we use the <strong><a href="https://git.launchpad.net/~canonical-is/charms/+source/interface-keystone-admin">keystone-admin interface</a></strong>.</p>

<p>With this in mind, we configure our charm to require this relation and interface in <code>metadata.yaml</code>:</p>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#75715e"># ...</span>
requires<span style="color:#111">:</span>
  identity-admin<span style="color:#111">:</span>
    interface<span style="color:#111">:</span> keystone-admin</code></pre></div>

  
  <div style="margin: 20px 0px;">
  
    <a href="https://aalvarez.me/tags/juju" class="label label-default">juju</a></li>
  
    <a href="https://aalvarez.me/tags/keystone" class="label label-default">keystone</a></li>
  
    <a href="https://aalvarez.me/tags/devops" class="label label-default">devops</a></li>
  
    <a href="https://aalvarez.me/tags/bash" class="label label-default">bash</a></li>
  
    <a href="https://aalvarez.me/tags/keystone" class="label label-default">keystone</a></li>
  
    <a href="https://aalvarez.me/tags/openstack" class="label label-default">openstack</a></li>
  
</div>


  
    <div class="read-more-link">
      <a href="https://aalvarez.me/posts/keystone-interface-in-juju-charms/">Read More…</a>
    </div>
  
</article>






  <div>
    
      <a href="https://aalvarez.me//page/19/" style="float: left;">← Newer Posts</a>
    

    
      <a href="https://aalvarez.me//page/21/" style="float: right;">Older Posts →</a>
    
  </div>



</div>
    </main>

    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-131322667-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

  </body>
</html>
