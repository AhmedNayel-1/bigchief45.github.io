<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">
<head>
  <link href="//gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="generator" content="Hugo 0.52" />

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  
  <script type="application/ld+json">
{
    "@context" : "http://schema.org",
    "@type" : "BlogPosting",
    "mainEntityOfPage": {
         "@type": "WebPage",
         "@id": "https://aalvarez.me/"
    },
    "articleSection" : "",
    "name" : "Andrés Álvarez",
    "headline" : "Andrés Álvarez",
    "description" : "",
    "inLanguage" : "en-US",
    "author" : "",
    "creator" : "",
    "publisher": "",
    "accountablePerson" : "",
    "copyrightHolder" : "",
    "copyrightYear" : "2017",
    "datePublished": "2017-11-27 00:00:00 &#43;0000 UTC",
    "dateModified" : "2017-11-27 00:00:00 &#43;0000 UTC",
    "url" : "https://aalvarez.me/",
    "wordCount" : "0",
    "keywords" : [ "Blog" ]
}
</script>


  
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-123-45', 'auto');
	
	ga('send', 'pageview');
}
</script>


  <title>Andrés Álvarez</title>

  
  <link type="text/css" rel="stylesheet" href="https://aalvarez.me/css/print.css" media="print">
  <link type="text/css" rel="stylesheet" href="https://aalvarez.me/css/poole.css">
  <link type="text/css" rel="stylesheet" href="https://aalvarez.me/css/syntax.css">
  <link type="text/css" rel="stylesheet" href="https://aalvarez.me/css/hyde.css">
  <link type="text/css" rel="stylesheet" href="https://aalvarez.me/css/extra.css">
  <link type="text/css" rel="stylesheet" href="https://aalvarez.me/css/overrides.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abril+Fatface|PT+Sans:400,400i,700">


  
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://aalvarez.me/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="https://aalvarez.me/favicon.png">

  
  <link href="https://aalvarez.me/index.xml" rel="alternate" type="application/rss+xml" title="Andrés Álvarez" />

  
</head>

  <body class="theme-base-08 ">
  <aside class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <a href="https://aalvarez.me/"><h1>Andrés Álvarez</h1></a>
      <p class="lead">
       Software Engineer &amp; Web Developer 
      </p>
    </div>

    <nav>
      <ul class="sidebar-nav">
        <li><a href="https://aalvarez.me/">Home</a> </li>
        <li><a href="https://aalvarez.me/tags/">Tags</a></li>
        <li><a href="https://aalvarez.me/about/"> About Me </a></li><li><a href="https://aalvarez.me/portfolio/"> Portfolio </a></li>
      </ul>
    </nav>

    
    <ul id="social-media" class="list-inline">
      
        <li>
           <a href="mailto:andresalvarez353@gmail.com" target="_blank"><i class="fa fa-envelope fa-2x" title="E-Mail"></i></a>
        </li>
      

      
        <li>
          <a href="https://linkedin.com/in/aalvarez4" target="_blank"><i class="fa fa-linkedin fa-2x" title="LinkedIn"></i></a>
        </li>
      

      
        <li>
          <a href="https://github.com/BigChief45" target="_blank"><i class="fa fa-github fa-2x" title="Github"></i></a>
        </li>
      

      
        <li>
          <a href="https://www.instagram.com/aalvarez300" target="_blank"><i class="fa fa-instagram fa-2x" title="Instagram"></i></a>
        </li>
      

      
        <li>
          <a href="https://aalvarez.me/index.xml" target="_blank"><i class="fa fa-rss fa-2x" title="RSS"></i></a>
        </li>
      
    </ul>

    <p>&copy; 2018. All rights reserved. </p>
  </div>
</aside>

    <main class="content container">
    <div class="posts">

<article class="post">
  <h1 class="post-title">
    <a href="https://aalvarez.me/posts/bulk-create-with-django-rest-framework/">Bulk Create With Django REST Framework</a>
  </h1>
  <time datetime="2017-11-27T00:00:00Z" class="post-date">Mon, Nov 27, 2017</time>
  <p>In this quick post I will go over how to create an endpoint that allows bulk creation of a resource using <a href="http://www.django-rest-framework.org/">Django REST Framework</a>.</p>

<h2 id="the-serializer">The Serializer</h2>

<p>Let&rsquo;s assume that we will be working with an existing <code>Book</code> model in our Django application. We will create a serializer for this model using Django REST&rsquo;s <a href="http://www.django-rest-framework.org/api-guide/serializers/#modelserializer">ModelSerializer</a> helper class:</p>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># serializers.py</span>
<span style="color:#f92672">from</span> <span style="color:#111">myapp.models</span> <span style="color:#f92672">import</span> <span style="color:#111">Book</span>
<span style="color:#f92672">from</span> <span style="color:#111">rest_framework</span> <span style="color:#f92672">import</span> <span style="color:#111">serializers</span>


<span style="color:#00a8c8">class</span> <span style="color:#75af00">BookSerializer</span><span style="color:#111">(</span><span style="color:#111">serializers</span><span style="color:#f92672">.</span><span style="color:#111">ModelSerializer</span><span style="color:#111">):</span>
    <span style="color:#00a8c8">class</span> <span style="color:#75af00">Meta</span><span style="color:#111">:</span>
        <span style="color:#111">model</span> <span style="color:#f92672">=</span> <span style="color:#111">Book</span>
        <span style="color:#111">fields</span> <span style="color:#f92672">=</span> <span style="color:#d88200">&#39;__all__&#39;</span></code></pre></div>
<p>The <code>&quot;__all__&quot;</code> string indicates that we want to serialize <strong>all</strong> of the model&rsquo;s fields.</p>

  
  <div style="margin: 20px 0px;">
  
    <a href="https://aalvarez.me/tags/python" class="label label-default">python</a></li>
  
    <a href="https://aalvarez.me/tags/djangorestframework" class="label label-default">djangorestframework</a></li>
  
</div>


  
    <div class="read-more-link">
      <a href="https://aalvarez.me/posts/bulk-create-with-django-rest-framework/">Read More…</a>
    </div>
  
</article>
<article class="post">
  <h1 class="post-title">
    <a href="https://aalvarez.me/posts/building-an-ocr-service-with-tesseractjs-in-aws-lambda/">Building an OCR Service With TesseractJS in AWS Lambda</a>
  </h1>
  <time datetime="2017-11-21T00:00:00Z" class="post-date">Tue, Nov 21, 2017</time>
  <p>The past few days I was trying to make <a href="https://github.com/naptha/tesseract.js">TesseractJS</a> work in <a href="https://aws.amazon.com/lambda/">AWS Lambda</a> so that I could do some OCR (Optical Character Recognition) on some images I had stored in an S3 bucket. However I am a bit new to NodeJS and I was running into some difficulties getting it to work in the Lambda environment. In this post I am going to go through some of these issues and how I solved them.</p>

<p>TesseractJS is a OCR library written in pure JavaScript. It can recognize the text in images, as well as provide information about the location of the paragraphs, lines, and words in the document.</p>

<p>We will be using a <strong>NodeJS 6.10</strong> runtime in AWS Lambda. And I will be deploying the service with <a href="https://claudiajs.com/">ClaudiaJS</a>.</p>

<h2 id="downloading-the-tesseractjs-files">Downloading the TesseractJS Files</h2>

<p>When running TesseractJS to recognize an image, TesseractJS will automatically begin downloading some files, which include tesseract language files, a core library file, and a worker file. These are all files that TesseractJS requires in order to correctly run.</p>

<p>The problem occurs when trying to download these inside AWS Lambda, since Lambda only allows writing to the <code>/tmp/</code> directory, you will get an error like this in your logs:</p>

<pre><code>Error: EROFS: read-only file system, open 'eng.traineddata'
</code></pre>

  
  <div style="margin: 20px 0px;">
  
    <a href="https://aalvarez.me/tags/nodejs" class="label label-default">nodejs</a></li>
  
    <a href="https://aalvarez.me/tags/aws-lambda" class="label label-default">aws lambda</a></li>
  
    <a href="https://aalvarez.me/tags/serverless" class="label label-default">serverless</a></li>
  
    <a href="https://aalvarez.me/tags/ocr" class="label label-default">ocr</a></li>
  
</div>


  
    <div class="read-more-link">
      <a href="https://aalvarez.me/posts/building-an-ocr-service-with-tesseractjs-in-aws-lambda/">Read More…</a>
    </div>
  
</article>
<article class="post">
  <h1 class="post-title">
    <a href="https://aalvarez.me/posts/creating-an-upload-progress-dialog-in-java/">Creating an Upload Progress Dialog in Java</a>
  </h1>
  <time datetime="2017-11-16T00:00:00Z" class="post-date">Thu, Nov 16, 2017</time>
  <p>Many Java file upload <a href="http://www.codejava.net/coding/swing-application-to-upload-files-to-ftp-server-with-progress-bar">tutorials</a> teach you how to show the current progress of a file upload using a JProgressBar in the user interface, usually placed in the main JFrame.</p>

<p>However I was trying make this much more visually appealing, like the way <a href="https://winscp.net/eng/index.php">WinSCP</a> does it:</p>

<p><img src="https://aalvarez.me/posts/creating-an-upload-progress-dialog-in-java/scp_file_upload.png" alt="SCP File Upload" /></p>

<p>This will require the use of another Swing class: JDialog. Basically the flow of the program will be like this:</p>

<ol>
<li>Main class with main method calls <code>SwingWorker</code> class.</li>
<li><code>SwingWorker</code> is in charge of doing the <em>actual</em> upload. It will also create an instance of a <code>JDialog</code> to show the current upload progress.</li>
<li><code>JDialog</code> class will contain the progress bar and other useful upload information.</li>
</ol>

  
  <div style="margin: 20px 0px;">
  
    <a href="https://aalvarez.me/tags/java" class="label label-default">java</a></li>
  
</div>


  
    <div class="read-more-link">
      <a href="https://aalvarez.me/posts/creating-an-upload-progress-dialog-in-java/">Read More…</a>
    </div>
  
</article>
<article class="post">
  <h1 class="post-title">
    <a href="https://aalvarez.me/posts/querying-nested-documents-in-elasticsearch/">Querying Nested Documents in ElasticSearch</a>
  </h1>
  <time datetime="2017-10-23T00:00:00Z" class="post-date">Mon, Oct 23, 2017</time>
  <p>The other day I was using ElasticSearch to build an index that would contain book documents. These book documents would then contain many pages, each page indicating its page number in the book, and its content as text, extrated from its own PDF file.</p>

<p>I wanted to perform some queries on a specific book so that ElasticSearch would return all the pages in the book which contained a certain word in its <code>text</code> field.</p>

<h2 id="nested-documents">Nested Documents</h2>

<p>ElasticSearch 5 supports [nested documents](). These are internally separate documents that will belong to a certain parent, in this case, a book. Before creating any books, we must first define a <a href="https://www.elastic.co/guide/en/elasticsearch/guide/current/nested-mapping.html">nested object mapping</a> for the index:</p>

<pre><code>PUT /my_index

{
  &quot;mappings&quot;: {
    &quot;book&quot;: {
      &quot;properties&quot;: {
        &quot;pages&quot;: {
          &quot;type&quot;: &quot;nested&quot;,
          &quot;properties&quot;: {
            &quot;id&quot;:    { &quot;type&quot;: &quot;integer&quot;  },
            &quot;text&quot;: { &quot;type&quot;: &quot;text&quot;  },
          }
        }
      }
    }
  }
}
</code></pre>

<p>Notice how the mapping is created using a <code>PUT</code> request at the <strong>index</strong> level.</p>

  
  <div style="margin: 20px 0px;">
  
    <a href="https://aalvarez.me/tags/elasticsearch" class="label label-default">elasticsearch</a></li>
  
</div>


  
    <div class="read-more-link">
      <a href="https://aalvarez.me/posts/querying-nested-documents-in-elasticsearch/">Read More…</a>
    </div>
  
</article>
<article class="post">
  <h1 class="post-title">
    <a href="https://aalvarez.me/posts/umask-permissions-in-a-puma-production-environment/">Umask Permissions in a Puma Production Environment</a>
  </h1>
  <time datetime="2017-10-18T00:00:00Z" class="post-date">Wed, Oct 18, 2017</time>
  <p>Recently I was having an issue with a Sinatra application deployed in a staging
server. The application was deployed with Puma and Nginx in the following location:</p>

<pre><code>/var/www/
</code></pre>

<p>This web service would then try to access some files in another directory on the server,
mounted as an SFTP directory. The Sinatra app would open these files and generate some
new files from them, depending on the HTTP request received.</p>

<p>The problem was that the operation would fail due to a permissions issue. I was baffled
since I had set <strong>read</strong> and <strong>write</strong> permissions to the directory and the files in it.</p>

<h2 id="umask-the-problem-and-solution">Umask: The Problem and Solution</h2>

<p>It took around two days to find the culprit: <strong>umask</strong>. In Linux, <a href="https://askubuntu.com/questions/44542/what-is-umask-and-how-does-it-work">umask</a>
acts as another set of permissions for <strong>processes</strong> and cannot be set for directories,
basically speaking.</p>

<p>I realized that this probably meant that the process running the Puma application server had
a umask configuration that was not allowing the generation of new files.</p>

<p>I decided to test this if this was the case. In the <a href="https://github.com/puma/puma">Puma</a>
documentation, I found an option to change the permissions of the UNIX socket using
umask:</p>

  
  <div style="margin: 20px 0px;">
  
    <a href="https://aalvarez.me/tags/ruby" class="label label-default">ruby</a></li>
  
    <a href="https://aalvarez.me/tags/sinatra" class="label label-default">sinatra</a></li>
  
    <a href="https://aalvarez.me/tags/web-dev" class="label label-default">web dev</a></li>
  
</div>


  
    <div class="read-more-link">
      <a href="https://aalvarez.me/posts/umask-permissions-in-a-puma-production-environment/">Read More…</a>
    </div>
  
</article>






  <div>
    
      <a href="https://aalvarez.me//page/4/" style="float: left;">← Newer Posts</a>
    

    
      <a href="https://aalvarez.me//page/6/" style="float: right;">Older Posts →</a>
    
  </div>



</div>
    </main>

    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-123-45', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

  </body>
</html>
