<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">
<head>
  <link href="//gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="generator" content="Hugo 0.52" />

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Custom Pages in Zenoss &middot; Andrés Álvarez</title>

  
  <link type="text/css" rel="stylesheet" href="http://aalvarez.mecss/print.css" media="print">
  <link type="text/css" rel="stylesheet" href="http://aalvarez.mecss/poole.css">
  <link type="text/css" rel="stylesheet" href="http://aalvarez.mecss/syntax.css">
  <link type="text/css" rel="stylesheet" href="http://aalvarez.mecss/hyde.css">
  <link type="text/css" rel="stylesheet" href="http://aalvarez.mecss/extra.css">
  <link type="text/css" rel="stylesheet" href="http://aalvarez.mecss/overrides.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abril+Fatface|PT+Sans:400,400i,700">


  
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/favicon.png">

  
  <link href="" rel="alternate" type="application/rss+xml" title="Andrés Álvarez" />

  
</head>

  <body class="theme-base-08 ">
  <aside class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <a href="http://aalvarez.me"><h1>Andrés Álvarez</h1></a>
      <p class="lead">
       Software Engineer &amp; Web Developer 
      </p>
    </div>

    <nav>
      <ul class="sidebar-nav">
        <li><a href="http://aalvarez.me">Home</a> </li>
        <li><a href="/tags/">Tags</a></li>
        <li><a href="/about/"> About Me </a></li><li><a href="/portfolio/"> Portfolio </a></li>
      </ul>
    </nav>

    
    <ul id="social-media" class="list-inline">
      
        <li>
           <a href="mailto:andresalvarez353@gmail.com" target="_blank"><i class="fa fa-envelope fa-2x" title="E-Mail"></i></a>
        </li>
      

      
        <li>
          <a href="https://linkedin.com/in/aalvarez4" target="_blank"><i class="fa fa-linkedin fa-2x" title="LinkedIn"></i></a>
        </li>
      

      
        <li>
          <a href="https://github.com/BigChief45" target="_blank"><i class="fa fa-github fa-2x" title="Github"></i></a>
        </li>
      

      
        <li>
          <a href="https://www.instagram.com/aalvarez300" target="_blank"><i class="fa fa-instagram fa-2x" title="Instagram"></i></a>
        </li>
      

      
        <li>
          <a href="/feed.xml" target="_blank"><i class="fa fa-rss fa-2x" title="RSS"></i></a>
        </li>
      
    </ul>

    <p>&copy; 2018. All rights reserved. </p>
  </div>
</aside>

    <main class="content container">
    <div class="post">
  <h1>Custom Pages in Zenoss</h1>
  <time datetime=2016-12-26T00:00:00Z class="post-date">Mon, Dec 26, 2016</time>

  <p>In a <a href="/posts/extending-zenoss-navigations.html">previous post</a> I talked about how to create custom navigation links in Zenoss using a ZenPack. However we didn&rsquo;t get to creating the custom pages that these links would link to. This is what we will learn today.</p>

<h2 id="page-viewlets">Page Viewlets</h2>

<p>Previously we created navigation item viewlets, this time we will be creating <strong>page</strong> viewlets. These type of viewlets allow us to create and insert new custom pages into Zenoss where we can display custom content. To create a new page, we add the following code to <code>browser/configure.zcml</code>:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#070">&lt;browser:page</span>
  <span style="color:#00c">name=</span><span style="background-color:#fff0f0">&#34;secondaryPage&#34;</span>
  <span style="color:#00c">for=</span><span style="background-color:#fff0f0">&#34;*&#34;</span>
  <span style="color:#00c">permission=</span><span style="background-color:#fff0f0">&#34;zenoss.View&#34;</span>
  <span style="color:#00c">template=</span><span style="background-color:#fff0f0">&#34;templates/my_template.pt&#34;</span>
  <span style="color:#070">/&gt;</span></code></pre></div>
<p>It is important that the <strong>name</strong> attribute matches the URL of the navigation link we created previously. Another important attribute is the <strong>template</strong> attribute, this is a special file that will represent the base markup of the page using a combination of HTML, TAL, and <a href="http://old.zope.org/Members/tone/METAL">METAL</a>.</p>

<p>Also let&rsquo;s not forget to create a necessary python init file:</p>

<pre><code>touch browser/__init__.py
</code></pre>

<h2 id="zope-zenoss-templates">Zope &amp; Zenoss Templates</h2>

<p>We will proceed and create the <code>my_template.pt</code> template in a new <em>templates</em> directory:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mkdir" data-lang="mkdir">browser/templates/
touch browser/templates/my_template.py</code></pre></div>
<p>The template code will basically consist of different tags that will represent <strong>slots</strong>. We can use tags to fill these slots with content and JavaScript, this is how we populate the page with content. A basic template file skeleton would look like this:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#070">tal:block</span> <span style="color:#00c">metal:use-macro</span><span style="color:#333">=</span><span style="background-color:#fff0f0">&#34;here/page_macros/base-new&#34;</span>&gt;
 &lt;<span style="color:#070">tal:block</span> <span style="color:#00c">metal:fill-slot</span><span style="color:#333">=</span><span style="background-color:#fff0f0">&#34;title&#34;</span>&gt;YOUR TITLE HERE&lt;/<span style="color:#070">tal:block</span>&gt;

 &lt;<span style="color:#070">tal:block</span> <span style="color:#00c">metal:fill-slot</span><span style="color:#333">=</span><span style="background-color:#fff0f0">&#34;head-local&#34;</span>&gt;
    &lt;<span style="color:#070">meta</span> <span style="color:#00c">http-equiv</span><span style="color:#333">=</span><span style="background-color:#fff0f0">&#34;X-UA-Compatible&#34;</span> <span style="color:#00c">content</span><span style="color:#333">=</span><span style="background-color:#fff0f0">&#34;IE=edge&#34;</span> /&gt;
 &lt;/<span style="color:#070">tal:block</span>&gt;

 &lt;<span style="color:#070">tal:block</span> <span style="color:#00c">metal:fill-slot</span><span style="color:#333">=</span><span style="background-color:#fff0f0">&#34;center_panel_content&#34;</span>&gt;
 &lt;/<span style="color:#070">tal:block</span>&gt;

 &lt;<span style="color:#070">tal:block</span> <span style="color:#00c">metal:fill-slot</span><span style="color:#333">=</span><span style="background-color:#fff0f0">&#34;script_layout&#34;</span>&gt;
 &lt;/<span style="color:#070">tal:block</span>&gt;

&lt;/<span style="color:#070">tal:block</span>&gt;</code></pre></div>
<p>Notice that we are leaving some slots unfilled for now, we will proceed to fill them later. The 1st line of the code above is very important:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#070">tal:block</span> <span style="color:#00c">metal:use-macro</span><span style="color:#333">=</span><span style="background-color:#fff0f0">&#34;here/page_macros/base-new&#34;</span>&gt;</code></pre></div>
<p>This code allows us to inherit from one of the many built-in Zenoss templates available. Each template has different page layout characteristics such as columns, menu bars, and other components. In this case we are using the <code>base-new</code> template.</p>

<p>You can see the list of templates that we can use by checking out the source code in <code>$ZENHOME/Products/ZenUI3/browser/macros.py</code>. These <code>.pt</code> template files are located in <code>$ZENHOME/Products/ZenUI3/browser/templates</code>.</p>

<h2 id="adding-content-to-the-page">Adding Content to the Page</h2>

<p>If we restart <em>zopectl</em> we can already see that the link works and it actually takes us to the new page that uses the <code>base-new</code> template. In the center we will see a big white space that is actually an <a href="http://docs.sencha.com/extjs/4.0.1/#!/api/Ext.panel.Panel">ExtJS panel</a> called <code>center_panel</code>. To add new stuff to this available area we need to do so using ExtJS framework.</p>

<p>Let&rsquo;s say we want to add a <a href="http://d3js.org/">D3 (Data Driven Documents)</a> example like <a href="http://bl.ocks.org/mbostock/1153292">Mobile Patent Suits</a> into the panel. First we need to include the JavaScript reference to the D3 library inside the <code>script_layout</code> slot, at the same time we can also add the CSS for the D3 visualization, and lastly the JavaScript code that will render the visualization (<code>mps.js</code>):</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#070">tal:block</span> <span style="color:#00c">metal:fill-slot</span><span style="color:#333">=</span><span style="background-color:#fff0f0">&#34;script_layout&#34;</span>&gt;
  &lt;<span style="color:#070">script</span> <span style="color:#00c">src</span><span style="color:#333">=</span><span style="background-color:#fff0f0">&#34;//d3js.org/d3.v3.min.js&#34;</span>&gt;&lt;/<span style="color:#070">script</span>&gt;
  &lt;<span style="color:#070">link</span> <span style="color:#00c">rel</span><span style="color:#333">=</span><span style="background-color:#fff0f0">&#34;stylesheet&#34;</span> <span style="color:#00c">type</span><span style="color:#333">=</span><span style="background-color:#fff0f0">&#34;text/css&#34;</span> <span style="color:#00c">href</span><span style="color:#333">=</span><span style="background-color:#fff0f0">&#34;++resource++myzenpackname/css/patent_suits.css&#34;</span>&gt;

  &lt;<span style="color:#070">script</span>
   <span style="color:#00c">tal:attributes</span><span style="color:#333">=</span><span style="background-color:#fff0f0">&#34;src python: context.zport.getVersionedResourcePath(&#39;/++resource++myzenpackname/js/mps.js&#39;)&#34;</span>
  &gt;
  &lt;/<span style="color:#070">script</span>&gt;
&lt;/<span style="color:#070">tal:block</span>&gt;</code></pre></div>
<p>~&gt; I am not sure if this is the best approach for calling the JavaScript file, the <a href="https://github.com/zenoss/ZenPacks.zenoss.Dashboard">Dashboard ZenPack</a> seems to use this approach. However other ZenPacks seem to take a different approach regardless of using <strong>zenpacklib</strong>.</p>

<p>Now we need to create the resource directory that will contain the CSS and JavaScript files:</p>

<pre><code>mkdir browser/resources
mkdir browser/resources/css
mkdir browser/resouces/js
</code></pre>

<p>Copy the CSS source code of the <em>Mobile Patent Suits</em> source code and place it in a file under <code>browser/resources/css/patent_suits.css</code>.</p>

<p>Then let&rsquo;s create the JavaScript file <code>browser/resources/js/mps.js</code> and paste the JavaScript source code after the following lines:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">Ext.onReady(<span style="color:#080;font-weight:bold">function</span>(){

  <span style="color:#888">// Create a panel to put the D3 visualization
</span><span style="color:#888"></span>  <span style="color:#080;font-weight:bold">var</span> suits_panel <span style="color:#333">=</span> Ext.create(<span style="background-color:#fff0f0">&#39;Ext.panel.Panel&#39;</span>, {
    flex<span style="color:#333">:</span> <span style="color:#00d;font-weight:bold">1</span>
  });

  <span style="color:#888">// Create a panel to represent the whole content area
</span><span style="color:#888"></span>  <span style="color:#080;font-weight:bold">var</span> hbox_center_panel <span style="color:#333">=</span> Ext.create(<span style="background-color:#fff0f0">&#39;Ext.panel.Panel&#39;</span>, {
    layout<span style="color:#333">:</span> {
      type<span style="color:#333">:</span> <span style="background-color:#fff0f0">&#39;hbox&#39;</span>,
      pack<span style="color:#333">:</span> <span style="background-color:#fff0f0">&#39;start&#39;</span>,
      align<span style="color:#333">:</span> <span style="background-color:#fff0f0">&#39;stretch&#39;</span>
    }
  });

  <span style="color:#888">// Add the visualization panel to the content area
</span><span style="color:#888"></span>  hbox_center_panel.add(suits_panel);

  <span style="color:#888">// Add the content panel to the original template panel
</span><span style="color:#888"></span>  Ext.getCmp(<span style="background-color:#fff0f0">&#39;center_panel&#39;</span>).add(hbox_center_panel);

  <span style="color:#888">// D3 Mobile Patent Suits code here
</span><span style="color:#888"></span>  <span style="color:#888">/*
</span><span style="color:#888">    ...
</span><span style="color:#888">  */</span>

  <span style="color:#888">// We will want to change this line from the D3 visualization,
</span><span style="color:#888"></span>  <span style="color:#888">// So that the SVG appends to the suits panel
</span><span style="color:#888"></span>  <span style="color:#080;font-weight:bold">var</span> svg <span style="color:#333">=</span> d3.select(<span style="background-color:#fff0f0">&#34;#&#34;</span> <span style="color:#333">+</span> suits_panel.body.id).append(<span style="background-color:#fff0f0">&#34;svg&#34;</span>)

});
</code></pre></div>
<h3 id="registering-the-resource-directory">Registering the Resource Directory</h3>

<p>In order for Zenoss to recognize our ZenPack resources, we need to register it in <code>browser/configure.zcml</code>:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#888">&lt;!-- Browser Resources --&gt;</span>
  <span style="color:#070">&lt;browser:resourceDirectory</span>
    <span style="color:#00c">name=</span><span style="background-color:#fff0f0">&#34;myzenpackname&#34;</span>
    <span style="color:#00c">directory=</span><span style="background-color:#fff0f0">&#34;resources&#34;</span>
    <span style="color:#070">/&gt;</span></code></pre></div>
<p>Be sure to use the correct <strong>name</strong> field when referencing the resources in page template files.</p>

<p>If we restart <em>zopectl</em> we should see the visualization in our new custom page:</p>

<p><img src="/posts/custom-pages-in-zenoss/d3_visualization.jpg" alt="D3 Visualization" /></p>

<p>In the screenshot above I actually just added a <em>Network Topology</em> secondary navigation link to INFRASTRUCTURE, and render the visualization on the new page for that link.</p>
</div>


<div style="margin: 20px 0px;">
  
    <a href="http://aalvarez.me/tags/zenoss" class="label label-default">zenoss</a></li>
  
    <a href="http://aalvarez.me/tags/extjs" class="label label-default">extjs</a></li>
  
    <a href="http://aalvarez.me/tags/javascript" class="label label-default">javascript</a></li>
  
    <a href="http://aalvarez.me/tags/zope" class="label label-default">zope</a></li>
  
    <a href="http://aalvarez.me/tags/zenpacks" class="label label-default">zenpacks</a></li>
  
    <a href="http://aalvarez.me/tags/d3" class="label label-default">d3</a></li>
  
</div>


<h2>Comments</h2>
<div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "aalvarez-blog" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </main>

    
  </body>
</html>
